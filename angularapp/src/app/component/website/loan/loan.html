<div class="apply-loan">
  <div class="form-header">
    <h1 class="form-title">Apply Loan</h1>
  </div>
<div class="back-container">
  <button class="back-button" (click)="goBack()">←Dashboard</button>
</div>

  <form (ngSubmit)="submitLoan()" #loanFormRef="ngForm">
    <div class="input-group">
      <label class="input-label">Loan Type</label>
      <select class="input-field" [(ngModel)]="loanForm.type" name="type" required>
        <option value="">Select Loan Type</option>
        <option value="Personal Loan">Personal Loan</option>
        <option value="Car Loan">Car Loan</option>
        <option value="Home Loan">Home Loan</option>
        <option value="Education Loan">Education Loan</option>
      </select>
    </div>

    <div class="input-group">
      <label class="input-label">Loan Amount</label>
      <input
        type="number"
        class="input-field"
        placeholder="Enter loan amount"
        [(ngModel)]="loanForm.amount"
        name="amount"
        required
      />
    </div>

    <div class="input-group">
      <label class="input-label">Tenure (Months)</label>
      <input
        type="number"
        class="input-field"
        placeholder="Loan tenure in months"
        [(ngModel)]="loanForm.tenure"
        name="tenure"
        required
      />
    </div>

    <div class="input-group">
      <label class="input-label">Interest Rate (%)</label>
      <input
        type="number"
        class="input-field"
        placeholder="Annual interest rate"
        [(ngModel)]="loanForm.interestRate"
        name="interestRate"
        required
      />
    </div>

    <div class="form-actions">
      <button class="submit-button" type="submit">Apply Loan</button>
      <button class="calculate-button" type="button" (click)="fillEMICalculator()">Calculate EMI</button>
    </div>
  </form>

  <!-- EMI Calculator Section -->
  <div class="emi-calculator">
    <h2>EMI Calculator</h2>
    <div class="calculator-container">
      <div class="calculator-inputs">
        <div class="input-group">
          <label class="input-label">Loan Amount (₹)</label>
          <input
            type="number"
            class="input-field"
            placeholder="Enter loan amount"
            [(ngModel)]="emiCalculator.principal"
            (input)="calculateEMI()"
            name="emiPrincipal"
          />
        </div>

        <div class="input-group">
          <label class="input-label">Interest Rate (% per annum)</label>
          <input
            type="number"
            class="input-field"
            placeholder="Enter interest rate"
            [(ngModel)]="emiCalculator.rate"
            (input)="calculateEMI()"
            name="emiRate"
            step="0.01"
          />
        </div>

        <div class="input-group">
          <label class="input-label">Loan Tenure (Months)</label>
          <input
            type="number"
            class="input-field"
            placeholder="Enter tenure in months"
            [(ngModel)]="emiCalculator.time"
            (input)="calculateEMI()"
            name="emiTime"
          />
        </div>
      </div>

      <div class="calculator-results" *ngIf="emiCalculator.emi > 0">
        <div class="result-card">
          <h3>EMI Calculation Results</h3>
          <div class="result-item">
            <span class="result-label">Monthly EMI:</span>
            <span class="result-value">₹{{ emiCalculator.emi | number:'1.2-2' }}</span>
          </div>
          <div class="result-item">
            <span class="result-label">Total Amount:</span>
            <span class="result-value">₹{{ emiCalculator.totalAmount | number:'1.2-2' }}</span>
          </div>
          <div class="result-item">
            <span class="result-label">Total Interest:</span>
            <span class="result-value">₹{{ emiCalculator.totalInterest | number:'1.2-2' }}</span>
          </div>
          <div class="result-item">
            <span class="result-label">Interest Percentage:</span>
            <span class="result-value">{{ emiCalculator.interestPercentage | number:'1.2-2' }}%</span>
          </div>
        </div>

        <div class="emi-breakdown" *ngIf="emiCalculator.emi > 0">
          <h4>EMI Breakdown</h4>
          <div class="breakdown-chart">
            <div class="breakdown-item">
              <div class="breakdown-bar principal" [style.width.%]="emiCalculator.principalPercentage"></div>
              <span class="breakdown-label">Principal ({{ emiCalculator.principalPercentage | number:'1.1-1' }}%)</span>
            </div>
            <div class="breakdown-item">
              <div class="breakdown-bar interest" [style.width.%]="emiCalculator.interestPercentage"></div>
              <span class="breakdown-label">Interest ({{ emiCalculator.interestPercentage | number:'1.1-1' }}%)</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="loan-list" *ngIf="loans.length > 0">
    <h2>My Loan Requests</h2>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Loan Account</th>
          <th>Type</th>
          <th>Amount</th>
          <th>Tenure</th>
          <th>Interest Rate</th>
          <th>Status</th>
          <th>Applied Date</th>
          <th>Approved Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let loan of loans">
          <td>{{ loan.id }}</td>
          <td>{{ loan.loanAccountNumber }}</td>
          <td>{{ loan.type }}</td>
          <td>₹{{ loan.amount }}</td>
          <td>{{ loan.tenure }} months</td>
          <td>{{ loan.interestRate }}%</td>
          <td [class.pending]="loan.status === 'Pending'"
              [class.approved]="loan.status === 'Approved'"
              [class.rejected]="loan.status === 'Rejected'">
            {{ loan.status }}
          </td>
          <td>{{ loan.applicationDate | date:'short' }}</td>
          <td>{{ loan.approvalDate ? (loan.approvalDate | date:'short') : '-' }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
