<div class="profile-container">
  <div class="profile-header">
    <button class="back-btn" (click)="goBack()">‚Üê Back to Dashboard</button>
    <h2>My Profile</h2>
  </div>

  <div class="profile-content">
    <!-- Profile Card -->
    <div class="profile-card">
      <div class="profile-avatar">
        <div class="avatar-circle" *ngIf="!profilePhotoUrl">
          <span class="avatar-text">{{ userProfile.name.charAt(0) }}</span>
        </div>
        <img *ngIf="profilePhotoUrl" [src]="profilePhotoUrl" alt="Profile Photo" class="profile-photo-img">
      </div>
      
      <div class="profile-info">
        <h3>{{ userProfile.name }}</h3>
        <p class="account-type">{{ userProfile.accountType }}</p>
        <p class="account-number">Account: {{ userProfile.accountNumber }}</p>
      </div>

      <div class="balance-section">
        <div class="balance-card">
          <h4>Current Balance</h4>
          <p class="balance-amount">‚Çπ{{ currentBalance | number:'1.2-2' }}</p>
        </div>
      </div>
    </div>

    <!-- Profile Photo Section -->
    <div class="details-section">
      <h3>Profile Photo</h3>
      <div class="upload-section">
        <div class="photo-preview-container">
          <div class="passport-photo-frame" *ngIf="profilePhotoUrl">
            <img [src]="profilePhotoUrl" alt="Profile Photo Preview" class="passport-size-photo">
          </div>
          <div class="no-photo-placeholder" *ngIf="!profilePhotoUrl">
            <div class="placeholder-icon">üì∑</div>
            <p>No photo uploaded</p>
          </div>
        </div>
        <div class="upload-controls">
          <input 
            type="file" 
            id="profilePhotoInput" 
            accept="image/jpeg,image/jpg,image/png,application/pdf"
            (change)="onProfilePhotoSelected($event)"
            style="display: none;"
          />
          <button 
            type="button"
            class="upload-button-primary"
            (click)="triggerFileInput('profilePhotoInput')"
          >
            <span class="button-icon">üì§</span>
            <span>Choose Profile Photo</span>
          </button>
          <button 
            *ngIf="profilePhoto" 
            class="upload-button-secondary" 
            (click)="uploadProfilePhoto()"
            [disabled]="uploadingPhoto"
            type="button"
          >
            <span *ngIf="!uploadingPhoto" class="button-icon">‚úì</span>
            <span *ngIf="!uploadingPhoto">Upload Photo</span>
            <span *ngIf="uploadingPhoto" class="button-icon">‚è≥</span>
            <span *ngIf="uploadingPhoto">Uploading...</span>
          </button>
          <p class="file-info-text">Accepted: JPEG, PNG, PDF | Max Size: 5MB</p>
        </div>
      </div>
    </div>

    <!-- Signature Section -->
    <div class="details-section">
      <h3>Digital Signature</h3>
      <div class="upload-section">
        <div class="signature-status" *ngIf="signatureStatus">
          <span class="status-badge" [ngClass]="getSignatureStatusClass()">
            {{ getSignatureStatusText() }}
          </span>
          <p *ngIf="signatureStatus === 'REJECTED' && signatureRejectionReason" class="rejection-reason">
            Reason: {{ signatureRejectionReason }}
          </p>
        </div>
        <div class="signature-preview-container" *ngIf="showSignature && signatureUrl">
          <div class="signature-frame">
            <img [src]="signatureUrl" alt="Signature Preview" class="signature-preview-image">
          </div>
        </div>
        <div class="signature-actions" *ngIf="signatureStatus">
          <button 
            *ngIf="!showSignature"
            type="button"
            class="show-signature-btn"
            (click)="showSignature = true; loadSignatureImage()"
          >
            <span class="button-icon">üëÅÔ∏è</span>
            <span>Show Signature</span>
          </button>
          <button 
            *ngIf="showSignature"
            type="button"
            class="hide-signature-btn"
            (click)="showSignature = false; signatureUrl = null"
          >
            <span class="button-icon">üôà</span>
            <span>Hide Signature</span>
          </button>
        </div>
        <div class="upload-controls">
          <input 
            type="file" 
            id="signatureInput" 
            accept="image/jpeg,image/jpg,image/png,application/pdf"
            (change)="onSignatureSelected($event)"
            style="display: none;"
          />
          <button 
            type="button"
            class="upload-button-primary"
            (click)="triggerFileInput('signatureInput')"
          >
            <span class="button-icon">üì§</span>
            <span>Choose Signature</span>
          </button>
          <button 
            *ngIf="signature" 
            class="upload-button-secondary" 
            (click)="uploadSignature()"
            [disabled]="uploadingSignature"
            type="button"
          >
            <span *ngIf="!uploadingSignature" class="button-icon">‚úì</span>
            <span *ngIf="!uploadingSignature">Upload Signature</span>
            <span *ngIf="uploadingSignature" class="button-icon">‚è≥</span>
            <span *ngIf="uploadingSignature">Uploading...</span>
          </button>
          <p class="file-info-text">Accepted: JPEG, PNG, PDF | Max Size: 5MB</p>
        </div>
        <p class="info-text">* Signature requires admin approval before it can be used.</p>
      </div>
    </div>

    <!-- Personal Details -->
    <div class="details-section">
      <h3>Personal Information</h3>
      <div class="details-grid">
        <div class="detail-item">
          <label>Full Name</label>
          <p>{{ userProfile.name }}</p>
        </div>
        <div class="detail-item">
          <label>Email Address</label>
          <div *ngIf="!editingEmail" class="email-display">
            <p>{{ userProfile.email }}</p>
            <button class="edit-email-btn" (click)="startEditingEmail()" type="button">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
              Update
            </button>
          </div>
          <div *ngIf="editingEmail" class="email-edit">
            <input 
              type="email" 
              [(ngModel)]="newEmail" 
              class="email-input"
              placeholder="Enter new email"
              [disabled]="updatingEmail"
            />
            <div class="email-error" *ngIf="emailError">{{ emailError }}</div>
            <div class="email-actions">
              <button 
                class="save-email-btn" 
                (click)="updateEmail()" 
                [disabled]="updatingEmail"
                type="button"
              >
                <span *ngIf="!updatingEmail">Save</span>
                <span *ngIf="updatingEmail">Updating...</span>
              </button>
              <button 
                class="cancel-email-btn" 
                (click)="cancelEditingEmail()" 
                [disabled]="updatingEmail"
                type="button"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
        <div class="detail-item">
          <label>Account Number</label>
          <p>{{ userProfile.accountNumber }}</p>
        </div>
        <div class="detail-item">
          <label>IFSC Code</label>
          <p>{{ userProfile.ifscCode }}</p>
        </div>
        <div class="detail-item">
          <label>Phone Number</label>
          <p>{{ userProfile.phoneNumber || 'Not provided' }}</p>
        </div>
        <div class="detail-item">
          <label>Date of Birth</label>
          <p>{{ userProfile.dateOfBirth || 'Not provided' }}</p>
        </div>
        <div class="detail-item">
          <label>Address</label>
          <p>{{ userProfile.address || 'Not provided' }}</p>
        </div>
        <div class="detail-item">
          <label>Account Type</label>
          <p>{{ userProfile.accountType }}</p>
        </div>
        <div class="detail-item">
          <label>Member Since</label>
          <p>{{ userProfile.joinDate }}</p>
        </div>
        <div class="detail-item" *ngIf="userProfile.pan">
          <label>PAN Number</label>
          <p>{{ userProfile.pan }}</p>
        </div>
        <div class="detail-item" *ngIf="userProfile.aadhar">
          <label>Aadhar Number</label>
          <div class="aadhar-section">
            <p>{{ userProfile.aadhar }}</p>
            <div class="verification-status">
              <span class="status-badge" [ngClass]="getAadharStatusClass()">
                {{ getAadharStatusText() }}
              </span>
              <span *ngIf="userProfile.aadharVerified && userProfile.aadharVerifiedDate" class="verified-date">
                Verified on: {{ userProfile.aadharVerifiedDate | date:'short' }}
              </span>
            </div>
            <button 
              *ngIf="!userProfile.aadharVerified || userProfile.aadharVerificationStatus === 'FAILED'"
              type="button"
              class="verify-aadhar-btn"
              (click)="initiateAadharVerification()"
              [disabled]="aadharVerifying || !userProfile.aadhar"
            >
              <span *ngIf="!aadharVerifying">üîê Verify Aadhaar</span>
              <span *ngIf="aadharVerifying">‚è≥ Verifying...</span>
            </button>
            <div *ngIf="userProfile.aadharVerificationStatus === 'PENDING'" class="verification-pending">
              <p class="pending-message">‚ö†Ô∏è Verification in progress. Please complete the process on Aadhaar website.</p>
            </div>
          </div>
        </div>
        <div class="detail-item" *ngIf="userProfile.occupation">
          <label>Occupation</label>
          <p>{{ userProfile.occupation }}</p>
        </div>
        <div class="detail-item" *ngIf="userProfile.income">
          <label>Annual Income</label>
          <p>‚Çπ{{ userProfile.income | number:'1.2-2' }}</p>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="edit-btn" (click)="editProfile()">Edit Profile</button>
      <button class="refresh-btn" (click)="loadCurrentBalance()">Refresh Balance</button>
      <button 
        class="generate-passbook-btn" 
        (click)="generatePassbook()"
        [disabled]="generatingPassbook"
        type="button"
      >
        <span *ngIf="!generatingPassbook" class="button-icon">üìÑ</span>
        <span *ngIf="!generatingPassbook">Generate Passbook</span>
        <span *ngIf="generatingPassbook" class="button-icon">‚è≥</span>
        <span *ngIf="generatingPassbook">Generating...</span>
      </button>
    </div>
  </div>
</div>
