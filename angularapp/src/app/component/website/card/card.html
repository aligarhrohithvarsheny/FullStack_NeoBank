<section>
  <div class="back-button">
    <button (click)="goBack()">‚¨Ö Back to Dashboard</button>
    <button (click)="refreshCardData()" class="refresh-btn">Refresh Card Data</button>
  </div>

  <!-- User Info Display -->
  <div *ngIf="userProfile" class="user-info">
    <h3>Account Information</h3>
    <p><strong>Account Number:</strong> {{ userProfile.accountNumber }}</p>
    <p><strong>Name:</strong> {{ userProfile.name }}</p>
    <p><strong>Email:</strong> {{ userProfile.email }}</p>
  </div>

  <!-- Card Display -->
  <div *ngIf="card" class="card-container">
    <div class="card" [ngClass]="statusClass" [class.flipped]="isCardFlipped" (click)="flipCard()">
      <!-- Front view -->
      <div class="view front">
        <div class="debit">{{ card.cardType }} Card</div>
        <div class="bank">NeoBank</div>
        <div class="number">{{ fullNumber }}</div>
        <div class="valid">
          <span>VALID THRU</span>
          <span>{{ card.expiry }}</span>
        </div>
        <div class="cardHolder">{{ card.userName }}</div>
        <div class="status-indicator">
          <span class="status-badge">{{ card.status }}</span>
        </div>
      </div>

      <!-- Back view -->
      <div class="view back">
        <div class="blackbar"></div>
        <div class="cvvtext">
          <h5>CVV</h5>
          <div class="whiteBar"></div>
          <div class="cvv">{{ maskedCVV }}</div>
        </div>
        <div class="text">
          Use responsibly. Cardholder agrees to terms.
        </div>
      </div>
    </div>

    <!-- Card Details -->
    <div class="card-details">
      <h4>Card Information</h4>
      <div class="detail-grid">
        <div class="detail-item">
          <span class="label">Card Number:</span>
          <span class="value">{{ fullNumber }}</span>
        </div>
        <div class="detail-item">
          <span class="label">Card Type:</span>
          <span class="value">{{ card.cardType }}</span>
        </div>
        <div class="detail-item">
          <span class="label">Expiry Date:</span>
          <span class="value">{{ card.expiry }}</span>
        </div>
        <div class="detail-item">
          <span class="label">CVV:</span>
          <span class="value">{{ maskedCVV }}</span>
          <button (click)="toggleCVV()" class="cvv-toggle-btn">
            {{ showCVV ? 'Hide CVV' : 'Show CVV' }}
          </button>
        </div>
        <div class="detail-item">
          <span class="label">Status:</span>
          <span class="value status-value" [ngClass]="statusClass">{{ card.status }}</span>
        </div>
        <div class="detail-item">
          <span class="label">PIN Status:</span>
          <span class="value">{{ card.pinSet ? 'Set' : 'Not Set' }}</span>
        </div>
        <div class="detail-item">
          <span class="label">Created:</span>
          <span class="value">{{ card.createdAt | date:'medium' }}</span>
        </div>
        <div class="detail-item">
          <span class="label">Last Updated:</span>
          <span class="value">{{ card.lastUpdated | date:'medium' }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Card Actions -->
  <div class="card-actions">
    <div class="action-group">
      <button (click)="toggleDetails()" class="toggle-btn">
        {{ showDetails ? 'Hide Card Details' : 'Show Card Details' }}
      </button>
    </div>

    <div class="action-group">
      <button (click)="togglePinForm()" class="pin-btn" [disabled]="card?.pinSet">
        {{ card?.pinSet ? 'PIN Already Set' : 'Set PIN' }}
      </button>
      
      <button *ngIf="card?.pinSet" (click)="toggleForgotPinForm()" class="forgot-pin-btn">
        Forgot PIN
      </button>
      
      <div *ngIf="showPinForm" class="pin-form">
        <input 
          type="password" 
          placeholder="Enter 4-digit PIN" 
          [(ngModel)]="newPin" 
          maxlength="4"
          class="pin-input"
        >
        <button (click)="setPin()" class="set-pin-btn">Set PIN</button>
        <button (click)="togglePinForm()" class="cancel-btn">Cancel</button>
      </div>

      <div *ngIf="showForgotPinForm" class="forgot-pin-form">
        <h5>üîê Reset Your PIN</h5>
        <p class="forgot-pin-info">Enter a new 4-digit PIN to replace your current PIN.</p>
        <input 
          type="password" 
          placeholder="Enter new 4-digit PIN" 
          [(ngModel)]="newPin" 
          maxlength="4"
          class="pin-input"
        >
        <div class="forgot-pin-actions">
          <button (click)="resetPin()" class="reset-pin-btn">Reset PIN</button>
          <button (click)="toggleForgotPinForm()" class="cancel-btn">Cancel</button>
        </div>
      </div>
    </div>

    <div class="action-group">
      <button (click)="toggleReplaceForm()" class="replace-btn">
        Request Card Replacement
      </button>
      
      <div *ngIf="showReplaceForm" class="replace-form">
        <textarea 
          placeholder="Reason for replacement (e.g., Lost card, Damaged card, etc.)" 
          [(ngModel)]="replaceReason"
          class="replace-textarea"
          rows="3"
        ></textarea>
        <button (click)="requestCardReplacement()" class="submit-replace-btn">Submit Request</button>
        <button (click)="toggleReplaceForm()" class="cancel-btn">Cancel</button>
      </div>
    </div>

    <div class="action-group">
      <button (click)="blockCard()" class="block-btn" [disabled]="card?.status === 'Blocked' || card?.status === 'Deactivated'">
        Block Card
      </button>
      <button (click)="deactivateCard()" class="deactivate-btn" [disabled]="card?.status === 'Deactivated'">
        Deactivate Card
      </button>
    </div>

    <div class="action-group">
      <button (click)="applyNewCard()" class="apply-new-card-btn">
        Apply for Additional Card
      </button>
    </div>
  </div>

  <!-- Status Info -->
  <div class="status-info">
    <div *ngIf="card?.pinSet" class="status-item pin-set">
      <span class="icon">üîí</span>
      <span class="text">PIN is set</span>
    </div>
    <div *ngIf="card?.status === 'Blocked'" class="status-item blocked">
      <span class="icon">‚ùå</span>
      <span class="text">Card is blocked</span>
    </div>
    <div *ngIf="card?.status === 'Deactivated'" class="status-item deactivated">
      <span class="icon">‚ö†Ô∏è</span>
      <span class="text">Card is deactivated</span>
    </div>
    <div *ngIf="card?.status === 'Replaced'" class="status-item replaced">
      <span class="icon">üîÑ</span>
      <span class="text">Card has been replaced</span>
    </div>
  </div>

  <!-- Instructions -->
  <div class="instructions">
    <h4>üìã Card Management Instructions:</h4>
    <ul>
      <li><strong>Set PIN:</strong> Create a 4-digit PIN for secure transactions</li>
      <li><strong>Forgot PIN:</strong> Reset your PIN if you've forgotten it</li>
      <li><strong>Block Card:</strong> Temporarily disable your card (can be unblocked by admin)</li>
      <li><strong>Deactivate Card:</strong> Permanently disable your card</li>
      <li><strong>Replace Card:</strong> Request a new card if lost or damaged</li>
      <li><strong>Apply New Card:</strong> Request an additional card for your account</li>
    </ul>
  </div>
</section>
