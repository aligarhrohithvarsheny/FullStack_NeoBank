<div class="admin-gold-loans-container">
  <header class="admin-header">
    <h2>ðŸ¥‡ Gold Loan Management</h2>
    <div class="header-actions">
      <button (click)="navigateToDashboard()" class="back-btn">â¬… Back to Dashboard</button>
      <button (click)="logout()" class="logout-btn">Logout</button>
    </div>
  </header>

  <!-- Gold Rate Management -->
  <div class="gold-rate-section">
    <h3>ðŸ“Š Gold Rate Management</h3>
    <div class="rate-card">
      <div class="current-rate" *ngIf="currentGoldRate">
        <div class="rate-info">
          <span class="rate-label">Current Rate (22K Gold):</span>
          <span class="rate-value">â‚¹{{ currentGoldRate.ratePerGram | number:'1.2-2' }} per gram</span>
        </div>
        <div class="rate-date">
          <span>Last Updated: {{ formatDate(currentGoldRate.lastUpdated) }}</span>
        </div>
      </div>
      <div class="update-rate-form">
        <label for="newGoldRate">Update Gold Rate (22K Gold - â‚¹ per gram):</label>
        <div class="rate-input-group">
          <input
            type="number"
            id="newGoldRate"
            [(ngModel)]="newGoldRate"
            placeholder="Enter new gold rate"
            min="0"
            step="0.01"
            class="rate-input"
          />
          <button
            type="button"
            class="update-rate-btn"
            (click)="updateGoldRate()"
            [disabled]="updatingRate || newGoldRate <= 0"
          >
            <span *ngIf="!updatingRate">Update Rate</span>
            <span *ngIf="updatingRate">Updating...</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Filter Section -->
  <div class="filter-section">
    <h3>Gold Loan Applications</h3>
    <div class="filter-buttons">
      <button
        type="button"
        (click)="filterStatus = 'Pending'; onFilterChange()"
        [class.active]="filterStatus === 'Pending'"
        class="filter-btn pending-filter"
      >
        Pending
      </button>
      <button
        type="button"
        (click)="filterStatus = 'Approved'; onFilterChange()"
        [class.active]="filterStatus === 'Approved'"
        class="filter-btn approved-filter"
      >
        Approved
      </button>
      <button
        type="button"
        (click)="filterStatus = 'Rejected'; onFilterChange()"
        [class.active]="filterStatus === 'Rejected'"
        class="filter-btn rejected-filter"
      >
        Rejected
      </button>
      <button
        type="button"
        (click)="filterStatus = 'All'; onFilterChange()"
        [class.active]="filterStatus === 'All'"
        class="filter-btn"
      >
        All
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="loading-spinner"></div>
    <p>Loading gold loans...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-message">
    <p>{{ error }}</p>
  </div>

  <!-- Gold Loans List -->
  <div *ngIf="!loading && !error" class="gold-loans-list">
    <div *ngIf="filteredLoans.length === 0" class="no-loans">
      <p>No gold loans found with status: {{ filterStatus }}</p>
    </div>

    <div *ngFor="let loan of filteredLoans" class="loan-card">
      <div class="loan-header">
        <div class="loan-info">
          <h4>Loan #{{ loan.loanAccountNumber || 'N/A' }}</h4>
          <span class="status-badge" [ngClass]="getStatusClass(loan.status)">
            {{ loan.status }}
          </span>
        </div>
        <div class="loan-actions" *ngIf="loan.status === 'Pending'">
          <button
            type="button"
            class="action-btn approve-btn"
            (click)="approveGoldLoan(loan, 'Approved')"
            [disabled]="approving"
          >
            <span *ngIf="!approving">âœ“ Approve</span>
            <span *ngIf="approving">Approving...</span>
          </button>
          <button
            type="button"
            class="action-btn reject-btn"
            (click)="approveGoldLoan(loan, 'Rejected')"
            [disabled]="approving"
          >
            âœ— Reject
          </button>
        </div>
      </div>

      <div class="loan-details">
        <div class="details-grid">
          <div class="detail-item">
            <span class="detail-label">Applicant Name:</span>
            <span class="detail-value">{{ loan.userName }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Account Number:</span>
            <span class="detail-value">{{ loan.accountNumber }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Email:</span>
            <span class="detail-value">{{ loan.userEmail }}</span>
          </div>
          <div class="detail-item highlight">
            <span class="detail-label">Gold Weight (22K):</span>
            <span class="detail-value">{{ loan.goldGrams }} grams</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Gold Rate (at application):</span>
            <span class="detail-value">â‚¹{{ loan.goldRatePerGram | number:'1.2-2' }} per gram</span>
          </div>
          <div class="detail-item highlight">
            <span class="detail-label">Total Gold Value:</span>
            <span class="detail-value">â‚¹{{ loan.goldValue | number:'1.2-2' }}</span>
          </div>
          <div class="detail-item highlight loan-amount">
            <span class="detail-label">Loan Amount (75%):</span>
            <span class="detail-value">â‚¹{{ loan.loanAmount | number:'1.2-2' }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Tenure:</span>
            <span class="detail-value">{{ loan.tenure }} months</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Interest Rate:</span>
            <span class="detail-value">{{ loan.interestRate }}% p.a.</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Application Date:</span>
            <span class="detail-value">{{ formatDate(loan.applicationDate) }}</span>
          </div>
          <div class="detail-item" *ngIf="loan.approvalDate">
            <span class="detail-label">Approval Date:</span>
            <span class="detail-value">{{ formatDate(loan.approvalDate) }}</span>
          </div>
          <div class="detail-item" *ngIf="loan.approvedBy">
            <span class="detail-label">Approved By:</span>
            <span class="detail-value">{{ loan.approvedBy }}</span>
          </div>
        </div>
      </div>

      <!-- Gold Details Section (if approved) -->
      <div class="gold-details-section" *ngIf="loan.status === 'Approved' && loan.goldItems">
        <h5>ðŸ“¦ Gold Details (Verified)</h5>
        <div class="details-grid">
          <div class="detail-item" *ngIf="loan.goldItems">
            <span class="detail-label">Gold Items:</span>
            <span class="detail-value">{{ loan.goldItems }}</span>
          </div>
          <div class="detail-item" *ngIf="loan.goldDescription">
            <span class="detail-label">Description:</span>
            <span class="detail-value">{{ loan.goldDescription }}</span>
          </div>
          <div class="detail-item" *ngIf="loan.goldPurity">
            <span class="detail-label">Verified Purity:</span>
            <span class="detail-value">{{ loan.goldPurity }}</span>
          </div>
          <div class="detail-item" *ngIf="loan.verifiedGoldGrams">
            <span class="detail-label">Verified Weight:</span>
            <span class="detail-value">{{ loan.verifiedGoldGrams }} grams</span>
          </div>
          <div class="detail-item" *ngIf="loan.verifiedGoldValue">
            <span class="detail-label">Verified Gold Value:</span>
            <span class="detail-value">â‚¹{{ loan.verifiedGoldValue | number:'1.2-2' }}</span>
          </div>
          <div class="detail-item" *ngIf="loan.storageLocation">
            <span class="detail-label">Storage Location:</span>
            <span class="detail-value">{{ loan.storageLocation }}</span>
          </div>
          <div class="detail-item" *ngIf="loan.verificationNotes">
            <span class="detail-label">Verification Notes:</span>
            <span class="detail-value">{{ loan.verificationNotes }}</span>
          </div>
          <div class="detail-item" *ngIf="loan.termsAccepted !== undefined">
            <span class="detail-label">Terms Accepted:</span>
            <span class="detail-value" [ngClass]="loan.termsAccepted ? 'status-approved' : 'status-pending'">
              {{ loan.termsAccepted ? 'Yes' : 'No' }}
            </span>
          </div>
          <div class="detail-item" *ngIf="loan.termsAcceptedDate">
            <span class="detail-label">Terms Accepted Date:</span>
            <span class="detail-value">{{ formatDate(loan.termsAcceptedDate) }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Gold Details Modal -->
<div class="modal-overlay" *ngIf="showGoldDetailsModal" (click)="cancelGoldDetails()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>ðŸ“¦ Enter Gold Details</h3>
      <button class="close-btn" (click)="cancelGoldDetails()">&times;</button>
    </div>
    <div class="modal-body">
      <form (ngSubmit)="submitGoldDetails()">
        <div class="form-group">
          <label for="goldItems">Gold Items Description <span class="required">*</span></label>
          <input
            type="text"
            id="goldItems"
            [(ngModel)]="goldDetailsForm.goldItems"
            name="goldItems"
            placeholder="e.g., 2 bangles, 1 chain, 3 rings"
            class="form-input"
            required
          />
          <small class="form-hint">Describe the gold items being pledged</small>
        </div>

        <div class="form-group">
          <label for="goldDescription">Detailed Description</label>
          <textarea
            id="goldDescription"
            [(ngModel)]="goldDetailsForm.goldDescription"
            name="goldDescription"
            placeholder="Enter detailed description of gold items..."
            class="form-textarea"
            rows="3"
          ></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="goldPurity">Gold Purity <span class="required">*</span></label>
            <select
              id="goldPurity"
              [(ngModel)]="goldDetailsForm.goldPurity"
              name="goldPurity"
              class="form-input"
              required
            >
              <option value="22K">22 Karat (22K)</option>
              <option value="18K">18 Karat (18K)</option>
              <option value="24K">24 Karat (24K)</option>
            </select>
          </div>

          <div class="form-group">
            <label for="verifiedGoldGrams">Verified Weight (grams) <span class="required">*</span></label>
            <input
              type="number"
              id="verifiedGoldGrams"
              [(ngModel)]="goldDetailsForm.verifiedGoldGrams"
              name="verifiedGoldGrams"
              placeholder="Enter verified weight"
              class="form-input"
              min="0"
              step="0.01"
              required
            />
            <small class="form-hint">Actual verified weight after testing</small>
          </div>
        </div>

        <div class="form-group">
          <label for="storageLocation">Storage Location</label>
          <input
            type="text"
            id="storageLocation"
            [(ngModel)]="goldDetailsForm.storageLocation"
            name="storageLocation"
            placeholder="e.g., Vault A-123, Branch XYZ"
            class="form-input"
          />
        </div>

        <div class="form-group">
          <label for="verificationNotes">Verification Notes</label>
          <textarea
            id="verificationNotes"
            [(ngModel)]="goldDetailsForm.verificationNotes"
            name="verificationNotes"
            placeholder="Enter any notes from verification process..."
            class="form-textarea"
            rows="3"
          ></textarea>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-cancel" (click)="cancelGoldDetails()" [disabled]="approving">
            Cancel
          </button>
          <button type="submit" class="btn-submit" [disabled]="approving">
            <span *ngIf="!approving">âœ“ Approve & Save Details</span>
            <span *ngIf="approving">Processing...</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

