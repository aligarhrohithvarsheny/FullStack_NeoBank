services:
  # Backend Service
  - type: web
    name: neobank-backend
    env: java
    buildCommand: cd springapp && mvn clean package -DskipTests
    startCommand: cd springapp && java -jar target/*.jar
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: production
      - key: SPRING_DATASOURCE_URL
        fromDatabase:
          name: neobank-db
          property: connectionString
      - key: SPRING_DATASOURCE_USERNAME
        fromDatabase:
          name: neobank-db
          property: user
      - key: SPRING_DATASOURCE_PASSWORD
        fromDatabase:
          name: neobank-db
          property: password
      - key: SPRING_DATASOURCE_DRIVER_CLASS_NAME
        value: com.mysql.cj.jdbc.Driver
      - key: SPRING_JPA_HIBERNATE_DDL_AUTO
        value: update
      - key: SPRING_JPA_SHOW_SQL
        value: "false"
      - key: SPRING_WEB_CORS_ALLOWED_ORIGINS
        sync: false  # Set this manually in Render dashboard

  # Frontend Service
  - type: web
    name: neobank-frontend
    env: static
    buildCommand: cd angularapp && npm install && npm run build:prod
    staticPublishPath: angularapp/dist/angularapp/browser
    envVars:
      - key: BACKEND_API_URL
        sync: false  # Set this manually in Render dashboard with your backend URL

  # Database
  - type: pspg
    name: neobank-db
    plan: starter
    databaseName: springapp
    user: neo


